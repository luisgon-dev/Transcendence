---
phase: 04-live-game-auth
plan: 04
type: execute
wave: 2
depends_on: ["04-02", "03-02", "03-04"]
files_modified:
  - Transcendence.Service.Core/Services/LiveGame/Models/LiveGameAnalysisDtos.cs
  - Transcendence.Service.Core/Services/LiveGame/Interfaces/ILiveGameAnalysisService.cs
  - Transcendence.Service.Core/Services/LiveGame/Implementations/LiveGameAnalysisService.cs
  - Transcendence.Service.Core/Services/LiveGame/Implementations/LiveGameService.cs
  - Transcendence.WebAPI/Controllers/LiveGameController.cs
autonomous: true

must_haves:
  truths:
    - "Live game responses include participant rank and recent performance (LIVE-02)"
    - "Responses include team composition strengths/weaknesses (LIVE-03)"
    - "Responses include team win probability estimate with factor breakdown (LIVE-04)"
  artifacts:
    - path: "Transcendence.Service.Core/Services/LiveGame/Implementations/LiveGameAnalysisService.cs"
      provides: "Participant/team enrichment and probability scoring"
      min_lines: 120
    - path: "Transcendence.Service.Core/Services/LiveGame/Models/LiveGameAnalysisDtos.cs"
      provides: "Structured participant + team analysis DTOs"
      min_lines: 60
  key_links:
    - from: "LiveGameAnalysisService"
      to: "ISummonerStatsService"
      via: "Recent performance and rank enrichment"
      pattern: "GetOverview"
    - from: "LiveGameAnalysisService"
      to: "IChampionAnalyticsService"
      via: "Meta/matchup enrichment"
      pattern: "GetMatchupsAsync"
---

<objective>
Add participant and team-level live analysis using existing stats and analytics services.

Purpose: Deliver LIVE-02/03/04 with actionable team insights for desktop champ-select workflows.

Output: Enriched live-game payload containing participant metrics, team strengths/weaknesses, and win probability.
</objective>

<execution_context>
@C:\Users\luigon\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\luigon\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-live-game-auth/04-CONTEXT.md
@Transcendence.Service.Core/Services/Analysis/Interfaces/ISummonerStatsService.cs
@Transcendence.Service.Core/Services/Analytics/Interfaces/IChampionAnalyticsService.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create analysis DTOs and service interface</name>
  <files>
    Transcendence.Service.Core/Services/LiveGame/Models/LiveGameAnalysisDtos.cs
    Transcendence.Service.Core/Services/LiveGame/Interfaces/ILiveGameAnalysisService.cs
  </files>
  <action>
Define DTOs for:
- Participant insight (rank, recent win rate, role/champion confidence)
- Team insight (strengths, weaknesses, risk flags)
- Win probability with explainable component scores
  </action>
  <verify>`dotnet build Transcendence.Service.Core`</verify>
  <done>Contracts defined for enrichment and API output</done>
</task>

<task type="auto">
  <name>Task 2: Implement LiveGameAnalysisService enrichment</name>
  <files>
    Transcendence.Service.Core/Services/LiveGame/Implementations/LiveGameAnalysisService.cs
  </files>
  <action>
Compute enrichment from existing services:
- Rank + recent performance by participant
- Team-level composition signals from matchup/tier data
- Deterministic probability model (weighted factors, no ML dependency)
Include fallback behavior when analytics sample size is insufficient.
  </action>
  <verify>Example payload includes factors and probability for both teams</verify>
  <done>LIVE-02/03/04 logic implemented with explainable output</done>
</task>

<task type="auto">
  <name>Task 3: Integrate enrichment into live endpoint</name>
  <files>
    Transcendence.Service.Core/Services/LiveGame/Implementations/LiveGameService.cs
    Transcendence.WebAPI/Controllers/LiveGameController.cs
  </files>
  <action>
Compose base Spectator payload + enrichment in endpoint response.
Ensure caching boundaries are clear (base live state short TTL, enrichment can share cache by game id + patch).
  </action>
  <verify>Endpoint returns enriched response under expected latency budget</verify>
  <done>Live-game API is fully analysis-capable for clients</done>
</task>

</tasks>

<acceptance_criteria>
1. Participant rank/recent performance included for all 10 players when available.
2. Team strengths/weaknesses explicitly listed.
3. Win probability reported with per-factor explanation.
</acceptance_criteria>
